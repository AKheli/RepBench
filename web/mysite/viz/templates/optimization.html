{% extends "base.html" %}
{% load static %}

{% block content %}
    <br>
    <div class="border" id="container" style="min-width: 310px; height: 400px; margin: 0 auto"></div>

    <div id="repair">
        <div class="column">
            <form onSubmit="return false" id="injection_form" class="form-vertical">

                <div class="colw flex-column-l">
                    {% csrf_token %}
                    {{ injection_form }}
                    <button id="injection_button">
                        Inject
                    </button>
                </div>
            </form>
        </div>

        <div class="column">
            <div class="bayesian-opt-form">
                {% for alg,params in b_opt_param_forms.items %}
                    {{ alg }}
                    <form class="bayesian-opt-form" id="{{ alg }}" onSubmit="return false">
                        {% for param in params %}
                            <label for="{{ param.param_name }}">{{ param.param_name }}</label>        <br>
                            min:<input type="text" id="{{ param.param_name }}"
                                       size="4" name = "{{ param.param_name }}-min"
                                       pattern="[+-]?([0-9]*[.])?[0-9]+" title="Must be a float value"
                                       value={{ param.min }}>
                            max:<input type="text" id="{{ param.param_name }}"
                                       size="4" name = "{{ param.param_name }}-max"
                                       pattern="[+-]?([0-9]*[.])?[0-9]+" title="Must be a float value"
                                       value="{{ param.max }}">
                            <br><br>
                        {% endfor %}
                        <div>
                            {{ bayesian_opt_form.as_p }}
                        </div>
                        <input type="submit" onclick="bayesian_opt_form('{{ alg }}')">
                    </form>
                {% endfor %}
            </div>
        </div>
    </div>

    </script>
    <script src="{% static  'js/scoreboard.js' %} " type="text/javascript"></script>
    <script src="{% static  'js/highchartsMainContainerInit.js' %} " type="text/javascript"></script>
    <script src="{% static  'js/highchartsInit.js' %}" type="text/javascript"></script>

    <script type="text/javascript">
        let data_url = '{% url "get_data" dataset=dataset %}'
        let selectionButton = document.getElementById("injection_button")
        let injection_url = "{% url 'inject' dataset=dataset %}"

        fetchChart(csrftoken, data_url)

        selectionButton.addEventListener("click", e => {
            e.stopPropagation()
            inject("injection_form", csrftoken, injection_url)
        })

        let optimization_url = "{% url 'optimize' dataset=dataset %}"
        let bayesian_opt_form = function (form_id) {
            optimizeCurrentData(form_id, csrftoken, optimization_url)
        }

    </script>

{% endblock %}
