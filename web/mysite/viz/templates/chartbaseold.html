{% extends "base.html" %}
{% load static %}

<!-- base template with a chart container of a dataset-->
{% block chartScript %}
    <script>
        let datasetName = "{{ set_name }}";
        let chart_title = "{{ data_title }}"

        let tooltip = {
            formatter: function (e) {
                // The first returned item is the header, subsequent items are the
                // points
                let x = this.x
                return ['<p style=\"color:black;font-size:15px;\"> Truth: ' + this.y + '</p>'].concat(
                    this.series.linkedSeries.map(function (s) {
                        selectedY = s.yData[x]
                        if (selectedY !== null) {
                            selectedY = Math.round(selectedY * 1000) / 1000
                            if (s.name.includes('injected')) {
                                return "<br> <p style=\"color:red;font-size:15px;\"> Anomalous: " + selectedY + "<\p> "
                            } else return "<br> <p style=\"color:" + s.color + ";font-size:15px;\">" + s.name + ": " + selectedY + "<\p> "
                        } else return ""
                    })
                );
            },
            shared: false,
            valueDecimals: 2
        }

        let range_selector = {
            buttons: [{
                count: 1,
                text: '1m',
                events: {
                    click: function () {
                        alert('Clicked button');
                    }
                }
            },
                {
                    count: 3,
                    text: '3m'
                }
            ],
            enabled: true,
        }
    </script>
{% endblock %}


{% block chart %}

    <div class="row" style="min-height: 500px">
        <div class="col-lg-9 col-md-12 col-sm-12 col-xs-12" id="container"></div>
        <div class="col-lg-3 col-md-3 col-sm-3 col-xs-3">
            {% block belowchart %}
            {% endblock %}
        </div>

    </div>


    <script>
        let data_url = '{% url "get_data" setname=setname  %}' + '?viz={{ viz|default_if_none:5 }}';
        const mainchart = Highcharts.chart(document.getElementById('container'), {

            tooltip: tooltip,

            chart: {
                type: 'line',
                zoomType: 'x',

            },

            title: {
                text: chart_title
            },


            {#rangeSelector :range_selector,#}

            series: []
        });

        fetch(data_url, {
            method: 'GET',
            headers: {
                'Content-Type': 'application/json',
                'X-CSRFToken': '{{ csrf_token }}'
            }
        }).then(response => response.json())
            .then(data => {
                data.series.forEach(x => mainchart.addSeries(x))
            })
            .catch(error => console.error(error))


    </script>
{% endblock %}

