{% extends "base.html" %}
{% load static %}


{% block content %}
    <style>
            .rs-tooltip-text {
                font-size: 12px;
                color: #0f0f16;
                font-weight: 900;
            }

            .rs-wrapper {
                display: grid;
                grid-template-columns: repeat(22, 200px);
            }

            .slider-container {
                max-height: 500px;
                overflow-y: scroll;
            }

            .center {
                display: flex;
                justify-content: center;
            }
        .overlay {
            position: absolute; /* position the overlay element absolutely */
            top: 0; /* position it at the top of the container */
            left: 0; /* position it at the left of the container */
            width: 100%; /* make it as wide as the container */
            height: 100%; /* make it as tall as the container */
            background-color: rgba(255, 255, 255, 0.7); /* add a semi-transparent background to make the overlay visible */
        }

        .container {
            position: relative; /* make the container a positioning context for the child elements */
        }
    </style>
    <div style="position:relative">
        {% include "sub/norm_buttons.html" %}
        {% block chartContainer %}
            {#            <div class="container">#}
            <div id="chart" class="col-md-9" style="position:relative;">
                <div id="load_chart" class="overlay full-height">
                </div>
                {% include 'sub/MainChart.html' %}
            </div>

        {% endblock %}
    </div>

    <div id="menu" class="col-md-3" style="margin-top: 40px">
        {% block menu %}
            {% block datasetInfo %}
                <h2>{{ data_info.title }}</h2>
                <a href="{{ data_info.ref_url }}"> {{ data_info.url_text }}</a>
                <p>{{ data_info.description }}</p>
                <p>Number of Values: {{ data_info.values }}</p>
                <p>Number of Time Series: {{ data_info.ts_nbr }}</p>

            {% endblock %}
            <div id="corr_container" style="max-height: 600px;">

            </div>

        {% endblock %}
    </div>
    </div>

    {% block sliders %}
        <div class="row margin-top-20 margin-bot-20 ">
            <div class="col-md-9" style="position:relative;">
                <div id="slider-container" style="display: none"></div>
            </div>

        </div>
        </div>
    {% endblock %}



    <script src='{% static "js/corr_table.js" %}'></script>

    {% block js %}
        <link href="{% static 'css/lib/roundslider/roundslider.min.css' %}" rel="stylesheet" type="text/css"/>
        <script src="{% static 'js/lib/roundslider/roundslider.min.js' %}"></script>
        <script src="{% static 'js/lib/roundslider/roundslider-init.js' %}"></script>


        <script>
            var categories = {{ columns | safe }};
            var corr_data = {{ corr_data | safe }};
            console.log(corr_data);
            initCorrTable(categories, corr_data, 'corr_container')

            /// addsliders


            function setInnerHTML(elm, html) {
                elm.innerHTML = html;
                Array.from(elm.querySelectorAll("script"))
                    .forEach(oldScriptEl => {
                        const newScriptEl = document.createElement("script");
                        Array.from(oldScriptEl.attributes).forEach(attr => {
                            newScriptEl.setAttribute(attr.name, attr.value)
                        });
                        const scriptText = document.createTextNode(oldScriptEl.innerHTML);
                        newScriptEl.appendChild(scriptText);
                        oldScriptEl.parentNode.replaceChild(newScriptEl, oldScriptEl);
                    });
            }

            document.addEventListener('DOMContentLoaded', () => {
                const myElement = document.querySelector('#slider-container');
                fetch("{% url 'get_sliders' setname=setname %}")
                    .then(response => response.text())
                    .then(html => {
                        const parser = new DOMParser();
                        const doc = parser.parseFromString(html, 'text/html');
                        setInnerHTML(myElement, html);
                        //display slider-container
                        document.getElementById('slider-container').style.display = 'block';
                    })
                    .catch(error => console.error(error));
            });
        </script>
    {% endblock %}
{% endblock %}

