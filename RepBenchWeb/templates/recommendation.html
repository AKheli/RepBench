{% extends "displayDataSetSynthetic.html" %}
{% load static %}


{% block menu %}
    <style>
<<<<<<< HEAD

        .menu-item {
            overflow: auto;

        }

        .mybox {
            background-color: white;
            padding: 14px; /* add padding to create space between the box and its contents */
            border: 2px solid #ccc; /* add a border to the box */
            border-radius: 5px; /* round the corners of the box */
            box-shadow: 1px 1px 3px #ccc; /* add a subtle shadow to the box */
            margin-top: 20px;
            margin-bottom: 5px;
            min-width: 0;
        }

=======
        .mybox {
            background-color: white;
            padding: 14px; /* add padding to create space between the box and its contents */
            border: 2px solid #ccc; /* add a border to the box */
            border-radius: 5px; /* round the corners of the box */
            box-shadow: 1px 1px 3px #ccc; /* add a subtle shadow to the box */
            margin-top: 20px;
            margin-bottom: 5px;
            min-width: 0;
        }

>>>>>>> d4294bb (Updated recommendation page)
        .mybox-header {
            position: relative;
            text-align: center;
            font-size: 15px;
            font-weight: bold;
        }

<<<<<<< HEAD
        .mybox-header {
            position: relative;
            text-align: center;
            font-size: 15px;
            font-weight: bold;
        }

        .mybox-header:not(button) { /* exclude .mybox-toggle from the margin-right rule */
            margin-right: 41px;
            margin-left: 41px;
        }


=======
        .menu-item {
            overflow: auto;

        }

>>>>>>> d4294bb (Updated recommendation page)
        .mybox-toggle {
            cursor: pointer;
            padding: 5px 10px 5px 10px;
        {#margin: 2px 2px 2px 2px;#} border: 1px solid #f1f1f1;
            border-radius: 3px;
            font-size: 20px;
            position: absolute;
<<<<<<< HEAD
            right: calc(-41px - 7px);
=======
            right: -7px;
>>>>>>> d4294bb (Updated recommendation page)
            top: 10px;
            z-index: 1000;
            transform: translateY(-50%);
        }

        .header-text {
            display: inline-block;
        }


    </style>
{#    <div class="menu-item">#}
        {#        <div class="mybox-header">#}
{#    </div>#}
    <div class="menu-item">
        <div id="recommendation-info">
            <div id="rec_info">

<<<<<<< HEAD
    <div class="menu-item">
        <div id="recommendation-info">
            <div id="rec_info">

                {#                <button id="descr-show" type="button" class="btn btn-default btn-xs"#}
                {#                        style="display:inline-block;padding:1px 3px 1px 4px">#}
                {#                    <span class="glyphicon glyphicon-info-sign" aria-hidden="true"></span> show description#}
                {#                </button>#}
                {#                <button style="display:none;;padding: 2px" id="descr-hide" type="button" class="btn btn-default btn-xs">#}
                {#                    <span class="glyphicon glyphicon-info-sign" aria-hidden="true"></span> hide description#}
                {#                </button>#}

                <div id="descr-options" class="mybox">
                    <div class="mybox-header">
                        <h2 style="padding-top:2px;margin-top:0px;">Repair Recommendation</h2>

                        <table style="border-spacing: 10px;">
                            <tr>
                                <td style="text-align:left; padding-right: 10px;">Recommend Algorithm</td>
                                <td style="text-align:left;" id="recommended_algorithm"></td>
                            </tr>
                            <tr>
                                <td style="text-align:left; padding-right: 10px;">Used Classifier</td>
                                <td style="text-align:left;" id="used_classifier"></td>
                            </tr>
                        </table>
                    </div>
                    <div class="mybox-content" style="display: none">
                        <p> Algorithm classification using <a href="https://microsoft.github.io/FLAML/">FLAML autoML</a>
                            to
                            recommend the
                            most
                            suitable anomaly repair algorithm. </p>
                        <p> Features from catch22, tsfresh and correlation values between the time series are used to
                            train
                            the
                            classifiers.
                        </p>
                        <p> The classifier options are lgbm, rf, xgboost, extra_tree, xgb_limitdepth and lrl1.
                        </p>

                        <h2>Dataset: {{ data_info.title }}</h2>
                        {#        </div>#}

                        <div class="mybox-content">
                            <div id="dataset-description">
                                {#                <h2>Dataset: {{ data_info.title }}</h2>#}
                                {#    <a href="{{ data_info.ref_url }}"> {{ data_info.url_text }}</a>#}
                                <p>{{ data_info.description }}</p>

                                <div>
                                    <table style="border-spacing: 10px;">
                                        <tr>
                                            <td style="text-align:left; padding-right: 10px;">Number of Values:</td>
                                            <td style="text-align:left;">{{ data_info.values }}</td>
                                        </tr>
                                        <tr>
                                            <td style="text-align:left; padding-right: 10px;">Number of TS:</td>
                                            <td style="text-align:left;">{{ data_info.ts_nbr }}</td>
                                        </tr>
                                        {% if data_info.original_data_set is not None %}
                                            <tr>
                                                <td style="text-align:left; padding-right: 10px;"> Original Dataset:
                                                </td>
                                                <td style="text-align:left;">
                                                    <a href="{% url 'display_dataset' setname=data_info.original_data_set %}">{{ data_info.original_data_set }}</a>
                                                </td>
                                            </tr>
                                        {% endif %}
                                    </table>
                                </div>
                            </div>
                        </div>
                    </div>

                </div>

=======
                {#                <button id="descr-show" type="button" class="btn btn-default btn-xs"#}
                {#                        style="display:inline-block;padding:1px 3px 1px 4px">#}
                {#                    <span class="glyphicon glyphicon-info-sign" aria-hidden="true"></span> show description#}
                {#                </button>#}
                {#                <button style="display:none;;padding: 2px" id="descr-hide" type="button" class="btn btn-default btn-xs">#}
                {#                    <span class="glyphicon glyphicon-info-sign" aria-hidden="true"></span> hide description#}
                {#                </button>#}

                <div id="descr-options" class="mybox">
                    <div class="mybox-header">
                        <h2 style="padding-top:2px;margin-top:0px;">Repair Recommendation</h2>

                        <table style="border-spacing: 10px;">
                            <tr>
                                <td style="text-align:left; padding-right: 10px;">Recommend Algorithm</td>
                                <td style="text-align:left;" id="recommended_algorithm"></td>
                            </tr>
                            <tr>
                                <td style="text-align:left; padding-right: 10px;">Used Classifier</td>
                                <td style="text-align:left;" id="used_classifier"></td>
                            </tr>
                        </table>
                    </div>
                    <div class="mybox-content" style="display: none">
                        <p> Algorithm classification using <a href="https://microsoft.github.io/FLAML/">FLAML autoML</a>
                            to
                            recommend the
                            most
                            suitable anomaly repair algorithm. </p>
                        <p> Features from catch22, tsfresh and correlation values between the time series are used to
                            train
                            the
                            classifiers.
                        </p>
                        <p> The classifier options are lgbm, rf, xgboost, extra_tree, xgb_limitdepth and lrl1.
                        </p>

                        <h2>Dataset: {{ data_info.title }}</h2>
                        {#        </div>#}

                        <div class="mybox-content">
                            <div id="dataset-description">
                                {#                <h2>Dataset: {{ data_info.title }}</h2>#}
                                {#    <a href="{{ data_info.ref_url }}"> {{ data_info.url_text }}</a>#}
                                <p>{{ data_info.description }}</p>

                                <div>
                                    <table style="border-spacing: 10px;">
                                        <tr>
                                            <td style="text-align:left; padding-right: 10px;">Number of Values:</td>
                                            <td style="text-align:left;">{{ data_info.values }}</td>
                                        </tr>
                                        <tr>
                                            <td style="text-align:left; padding-right: 10px;">Number of TS:</td>
                                            <td style="text-align:left;">{{ data_info.ts_nbr }}</td>
                                        </tr>
                                        {% if data_info.original_data_set is not None %}
                                            <tr>
                                                <td style="text-align:left; padding-right: 10px;"> Original Dataset:
                                                </td>
                                                <td style="text-align:left;">
                                                    <a href="{% url 'display_dataset' setname=data_info.original_data_set %}">{{ data_info.original_data_set }}</a>
                                                </td>
                                            </tr>
                                        {% endif %}
                                    </table>
                                </div>
                            </div>
                        </div>
                    </div>

                </div>

>>>>>>> d4294bb (Updated recommendation page)
            </div>
        </div>
    </div>
    <div class="menu-item">
        <div id="probability-container" class="mybox adjust-2 adjust-on ">
            <div class="mybox-header">
                Classification probabilities for each algorithm
            </div>
            <div id="probabilities-chart" class="mybox-content">
            </div>

        </div>
    </div>
    <div class="menu-item">
        <div id="alg-box" class="mybox adjust-3 adjust-on">
            <div class="mybox-header">
                Scores of each algorithm Computed using the true data
            </div>
            <div id="alg-scores-chart" class="mybox-content"></div>
        </div>
    </div>

{% endblock %}
{% block js %}
    <script type="text/javascript">
        let recommendation_url = "{% url 'get_recommendation' setname=setname %}"
    </script>
    {#    <script src="{% static 'js/repair.js' %}" type="text/javascript"></script>#}
    <script src="{% static 'js/recommendation/recommendation_charts.js' %}" type="text/javascript"></script>
    <script src="{% static 'js/recommendation/recommendation.js' %}" type="text/javascript"></script>




{% endblock %}



{% block additional_bottom_js %}
    <script>

        function setChartHeight(div) {
            const totalDivHeight = div.clientHeight - 20
            const secondChild = div.children[1];
            const secondChildHeight = secondChild.clientHeight
            let childrenHeight = -secondChildHeight
            Array.from(div.children).forEach(c => {
                console.log(c.style.height)
                childrenHeight += c.clientHeight
            })
            // second childs height = totalDivHeight - heighOfAllchilderen without the second
            secondChild.style.height = `${totalDivHeight - childrenHeight}px`;
        }

        function adjustLayout() {
            // get a reference to the container element

            {#// get a reference to the recommendation-info and footer-line elements#}
            const content = document.getElementById('graph-height').clientHeight;
            let siblingSpace = 0

            const adjustClassRegex = /^adjust-\d+$/;
            const allElements = document.querySelectorAll('*');
            const adjustElements = Array.from(allElements).filter(element => {
                if (Array.from(element.classList).some(className => adjustClassRegex.test(className))) {
                    if (element.classList.contains("adjust-on")) {
                        return true;
                    } else {
                        element.style.height = "";
                    }
                }
                return false;
            });

            document.querySelectorAll('.menu-item').forEach(e => {
                if (!e.children[0].classList.contains("adjust-on")) {
                    siblingSpace += e.clientHeight
                    console.log("uuuuu", siblingSpace)
                }
            })

            const availableSpace = content - siblingSpace - 40;

            // set height of elements to be adjusted
            let totalAdjustValue = 0;
            adjustElements.forEach(element => {
                const adjustValue = parseInt(element.className.split('-')[1]);
                totalAdjustValue += adjustValue;
            });

            adjustElements.forEach(element => {
                const adjustValue = parseInt(element.className.split('-')[1]);
                const elementHeight = (availableSpace * adjustValue / totalAdjustValue);
                element.style.height = `${elementHeight - 25}px`;
            });


            const algBox = document.getElementById('alg-box');
            const probabilityContainer = document.getElementById('probability-container');
            setChartHeight(algBox)
            setChartHeight(probabilityContainer)

            try {
                probabilityChart.reflow()
                scoreChart.reflow()
            } catch {
                console.log("charts not loaded yet")
            }

        }

        // call the adjustLayout function when the page is loaded and whenever the window is resized
        window.addEventListener('load', adjustLayout);
        window.addEventListener('resize', adjustLayout);

        $('#descr-show').click(function () {
            $('#descr-show').hide();
            $('#descr-hide').show();
            $('#descr-options').show();
            adjustLayout()
        });
        $('#descr-hide').click(function () {
            $('#descr-hide').hide();
            $('#descr-options').hide();
            $('#descr-show').show();
            adjustLayout()
        });


        function initMyBox() {

        }

        function addToggleButtons() {
            const headers = document.querySelectorAll('.mybox-header');

            headers.forEach(header => {
                const toggleBtn = document.createElement('button');
                const myboxContent = header.nextElementSibling;

                toggleBtn.classList.add('mdi', myboxContent.style.display === 'none' ? 'mdi-chevron-down' : "mdi-chevron-up",
                    'mdi-18px', 'mybox-toggle');

                toggleBtn.addEventListener('click', () => {
                    if (myboxContent.style.display === 'none') {
                        myboxContent.style.display = ''
                        toggleBtn.classList.add('mdi-chevron-up')
                        toggleBtn.classList.remove('mdi-chevron-down')
                        header.parentElement.classList.add("adjust-on")
                    } else {
                        myboxContent.style.display = 'none';
                        toggleBtn.classList.add('mdi-chevron-down')
                        toggleBtn.classList.remove('mdi-chevron-up')
                        header.parentElement.classList.remove("adjust-on")
                    }
                    adjustLayout()
                });
                header.appendChild(toggleBtn);


            });
        }

        addToggleButtons();

    </script>


{% endblock %}
